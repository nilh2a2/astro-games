---
import type { CollectionEntry } from "astro:content";
import { Image } from "astro:assets";
import getGamePath from "@/utils/getGamePath";
import { getUiText } from "@/utils/getUiText";
import { getCategoryLabel } from "@/utils/getCategoryLabels";

type Props = {
  variant?: "h2" | "h3";
} & CollectionEntry<"games">;

const { variant: Heading = "h2", data } = Astro.props;

const { title, thumbnail, category, rating, popular, new: isNew } = data;
const gamePath = getGamePath(Astro.props);
---

<li
  class="group border-skin-line bg-skin-card hover:border-skin-accent relative overflow-hidden rounded-lg border-2 transition-all"
>
  <a href={gamePath} class="block">
    <div class="bg-skin-accent/10 relative aspect-[16/10] overflow-hidden">
      {
        thumbnail ? (
          <Image
            src={thumbnail}
            alt={title}
            width={800}
            height={500}
            class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-110"
            loading="lazy"
          />
        ) : (
          <div class="from-skin-accent/20 to-skin-accent/5 flex h-full w-full items-center justify-center bg-gradient-to-br">
            <svg
              class="text-skin-accent/50 h-12 w-12"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
          </div>
        )
      }
      {
        isNew && (
          <span class="absolute top-2 right-2 rounded bg-green-500 px-2 py-1 text-xs font-bold text-white">
            {getUiText("badges.new")}
          </span>
        )
      }
      {
        popular && (
          <span class="absolute bottom-2 left-2 rounded bg-red-500 px-2 py-1 text-xs font-bold text-white">
            {getUiText("badges.popular")}
          </span>
        )
      }
    </div>
    <div class="p-4">
      <Heading class="text-skin-base mb-1 line-clamp-1 text-lg font-bold">
        {title}
      </Heading>
      <div class="text-skin-base/60 flex items-center justify-between text-xs">
        <span>{getCategoryLabel(category)}</span>
        <div class="flex items-center gap-3">
          {
            rating && (
              <span class="flex items-center gap-1">
                <svg class="h-4 w-4 fill-yellow-500" viewBox="0 0 20 20">
                  <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z" />
                </svg>
                {rating.toFixed(1)}
              </span>
            )
          }
        </div>
      </div>
    </div>
  </a>
</li>
