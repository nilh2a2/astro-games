---
import type { CollectionEntry } from "astro:content";
import { Image } from "astro:assets";
import getGamePath from "@/utils/getGamePath";
import { getUiText } from "@/utils/getUiText";
import { getCategoryLabel } from "@/utils/getCategoryLabels";

type Props = {
  variant?: "h2" | "h3";
} & CollectionEntry<"games">;

const { variant: Heading = "h2", data } = Astro.props;

const { title, description, thumbnail, category, rating, popular, new: isNew } = data;
const gamePath = getGamePath(Astro.props);
---

<li class="group relative overflow-hidden rounded-lg border-2 border-skin-line bg-skin-card transition-all hover:border-skin-accent">
  <a href={gamePath} class="block">
    <div class="relative aspect-[16/10] overflow-hidden bg-skin-accent/10">
      {thumbnail ? (
        <Image
          src={thumbnail}
          alt={title}
          class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-110"
          loading="lazy"
        />
      ) : (
        <div class="flex h-full w-full items-center justify-center bg-gradient-to-br from-skin-accent/20 to-skin-accent/5">
          <svg class="h-12 w-12 text-skin-accent/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
      )}
      {isNew && (
        <span class="absolute right-2 top-2 rounded bg-green-500 px-2 py-1 text-xs font-bold text-white">
          {getUiText("badges.new")}
        </span>
      )}
      {popular && (
        <span class="absolute left-2 bottom-2 rounded bg-red-500 px-2 py-1 text-xs font-bold text-white">
          {getUiText("badges.popular")}
        </span>
      )}
    </div>
    <div class="p-4">
      <Heading class="mb-1 line-clamp-1 text-lg font-bold text-skin-base">
        {title}
      </Heading>
      <div class="flex items-center justify-between text-xs text-skin-base/60">
        <span>{getCategoryLabel(category)}</span>
        <div class="flex items-center gap-3">
          {rating && (
            <span class="flex items-center gap-1">
              <svg class="h-4 w-4 fill-yellow-500" viewBox="0 0 20 20">
                <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z" />
              </svg>
              {rating.toFixed(1)}
            </span>
          )}
        </div>
      </div>
    </div>
  </a>
</li>
