---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Main from "@/layouts/Main.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import GameGrid from "@/components/GameGrid.astro";
import getGamesByCategory from "@/utils/getGamesByCategory";
import getSortedGames from "@/utils/getSortedGames";
import getUniqueCategories from "@/utils/getUniqueCategories";
import { getUiText } from "@/utils/getUiText";

export async function getStaticPaths() {
  const games = await getCollection("games");
  const categories = getUniqueCategories(games);
  return categories.map(category => ({
    params: { category },
  }));
}

const { category } = Astro.params as { category: string };

const games = await getCollection("games");
const sortedGames = getSortedGames(games);
const categoryGames = getGamesByCategory(sortedGames, category);
const allCategories = getUniqueCategories(games);

const categoryTitle = category.charAt(0).toUpperCase() + category.slice(1);
const pageTitle = getUiText("categories.pageTitle").replace("{category}", categoryTitle) + ` | ${getUiText("site.title")}`;
const pageDesc = getUiText("categories.pageDescription")
  .replace("{category}", categoryTitle.toLowerCase())
  .replace("{category}", categoryTitle.toLowerCase());
---

<Layout title={pageTitle} description={pageDesc}>
  <Header />
  <Main pageTitle={getUiText("categories.pageTitle").replace("{category}", categoryTitle)} pageDesc={pageDesc}>
    <!-- Category Navigation -->
    <nav class="mb-8 flex flex-wrap gap-2">
      {allCategories.map(cat => (
        <a
          href={`/category/${cat}/`}
          class:list={[
            "rounded-lg px-4 py-2 font-medium capitalize transition-colors",
            cat === category
              ? "bg-skin-accent text-white"
              : "bg-skin-card text-skin-base hover:bg-skin-accent/10"
          ]}
        >
          {cat}
        </a>
      ))}
    </nav>

    {categoryGames.length > 0 ? (
      <GameGrid games={categoryGames} />
    ) : (
      <div class="text-center py-12">
        <p class="text-lg text-skin-base/60">{getUiText("pages.categories.noGames")}</p>
      </div>
    )}
  </Main>

  <Footer />
</Layout>
