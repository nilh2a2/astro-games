---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Main from "@/layouts/Main.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import GameGrid from "@/components/GameGrid.astro";
import getGamesByCategory from "@/utils/getGamesByCategory";
import getSortedGames from "@/utils/getSortedGames";
import getUniqueCategories from "@/utils/getUniqueCategories";
import { getCategoryLabel } from "@/utils/getCategoryLabels";
import { getUiText } from "@/utils/getUiText";

export async function getStaticPaths() {
  const games = await getCollection("games");
  const categories = getUniqueCategories(games);
  return categories.map(category => ({
    params: { category },
  }));
}

const { category } = Astro.params as { category: string };

const games = await getCollection("games");
const sortedGames = getSortedGames(games);
const categoryGames = getGamesByCategory(sortedGames, category);
const allCategories = getUniqueCategories(games);

const categoryLabel = getCategoryLabel(category);
const pageTitle =
  getUiText("categories.pageTitle").replace("{category}", categoryLabel) +
  ` | ${getUiText("site.title")}`;
const pageDesc = getUiText("categories.pageDescription")
  .replace("{category}", categoryLabel.toLowerCase())
  .replace("{category}", categoryLabel.toLowerCase());
---

<Layout title={pageTitle} description={pageDesc}>
  <Header />
  <Main
    pageTitle={getUiText("categories.pageTitle").replace(
      "{category}",
      categoryLabel
    )}
    pageDesc={pageDesc}
  >
    <!-- Category Navigation -->
    <nav class="mb-8 flex flex-wrap gap-2">
      {
        allCategories.map(cat => (
          <a
            href={`/category/${cat}/`}
            class:list={[
              "rounded-lg px-4 py-2 font-medium transition-colors",
              cat === category
                ? "bg-skin-accent text-white"
                : "bg-skin-card text-skin-base hover:bg-skin-accent/10",
            ]}
          >
            {getCategoryLabel(cat)}
          </a>
        ))
      }
    </nav>

    {
      categoryGames.length > 0 ? (
        <GameGrid games={categoryGames} />
      ) : (
        <div class="py-12 text-center">
          <p class="text-skin-base/60 text-lg">
            {getUiText("pages.categories.noGames")}
          </p>
        </div>
      )
    }
  </Main>

  <Footer />
</Layout>
