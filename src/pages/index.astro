---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import LinkButton from "@/components/LinkButton.astro";
import GameGrid from "@/components/GameGrid.astro";
import getSortedGames from "@/utils/getSortedGames";
import getGamesByCategory from "@/utils/getGamesByCategory";
import IconArrowRight from "@/assets/icons/IconArrowRight.svg";

const games = await getCollection("games");
const sortedGames = getSortedGames(games);

// Get games by type
const popularGames = sortedGames.filter(({ data }) => data.popular);
const newGames = sortedGames.filter(({ data }) => data.new);

// Get games by category
const actionGames = getGamesByCategory(sortedGames, "action");
const racingGames = getGamesByCategory(sortedGames, "racing");
const sportsGames = getGamesByCategory(sortedGames, "sports");
const puzzleGames = getGamesByCategory(sortedGames, "puzzle");
const adventureGames = getGamesByCategory(sortedGames, "adventure");
const strategyGames = getGamesByCategory(sortedGames, "strategy");
---

<Layout>
  <Header />
  <main id="main-content" data-layout="index" class="app-layout">
    <!-- Hero Section -->
    <section id="hero" class:list={["py-6"]}>
      <p class="text-lg text-skin-base/90">
        Unblocked Games: Play online games. No downloads. Best collection of unlocked games for school in 2026. All featured games.
      </p>
    </section>

    <!-- Popular Games -->
    {
      popularGames.length > 0 && (
        <section id="popular" class="py-8">
          <div class="mb-6 flex items-center justify-between">
            <h2 class="text-2xl font-bold">Popular Games</h2>
          </div>
          <GameGrid games={popularGames.slice(0, 12)} />
        </section>
      )
    }

    <!-- New Games -->
    {
      newGames.length > 0 && (
        <section id="new" class="py-8">
          <div class="mb-6 flex items-center justify-between">
            <h2 class="text-2xl font-bold">New Games</h2>
          </div>
          <GameGrid games={newGames.slice(0, 12)} />
        </section>
      )
    }

    <!-- Action Games -->
    {
      actionGames.length > 0 && (
        <section id="action" class="py-8">
          <div class="mb-6 flex items-center justify-between">
            <h2 class="text-2xl font-bold">Action Games</h2>
            <LinkButton href="/category/action/">
              View All
              <IconArrowRight class="inline-block rtl:-rotate-180" />
            </LinkButton>
          </div>
          <GameGrid games={actionGames.slice(0, 6)} />
        </section>
      )
    }

    <!-- Racing Games -->
    {
      racingGames.length > 0 && (
        <section id="racing" class="py-8">
          <div class="mb-6 flex items-center justify-between">
            <h2 class="text-2xl font-bold">Racing Games</h2>
            <LinkButton href="/category/racing/">
              View All
              <IconArrowRight class="inline-block rtl:-rotate-180" />
            </LinkButton>
          </div>
          <GameGrid games={racingGames.slice(0, 6)} />
        </section>
      )
    }

    <!-- Sports Games -->
    {
      sportsGames.length > 0 && (
        <section id="sports" class="py-8">
          <div class="mb-6 flex items-center justify-between">
            <h2 class="text-2xl font-bold">Sports Games</h2>
            <LinkButton href="/category/sports/">
              View All
              <IconArrowRight class="inline-block rtl:-rotate-180" />
            </LinkButton>
          </div>
          <GameGrid games={sportsGames.slice(0, 6)} />
        </section>
      )
    }

    <!-- Puzzle Games -->
    {
      puzzleGames.length > 0 && (
        <section id="puzzle" class="py-8">
          <div class="mb-6 flex items-center justify-between">
            <h2 class="text-2xl font-bold">Puzzle Games</h2>
            <LinkButton href="/category/puzzle/">
              View All
              <IconArrowRight class="inline-block rtl:-rotate-180" />
            </LinkButton>
          </div>
          <GameGrid games={puzzleGames.slice(0, 6)} />
        </section>
      )
    }

    <!-- Adventure Games -->
    {
      adventureGames.length > 0 && (
        <section id="adventure" class="py-8">
          <div class="mb-6 flex items-center justify-between">
            <h2 class="text-2xl font-bold">Adventure Games</h2>
            <LinkButton href="/category/adventure/">
              View All
              <IconArrowRight class="inline-block rtl:-rotate-180" />
            </LinkButton>
          </div>
          <GameGrid games={adventureGames.slice(0, 6)} />
        </section>
      )
    }

    <!-- Strategy Games -->
    {
      strategyGames.length > 0 && (
        <section id="strategy" class="py-8">
          <div class="mb-6 flex items-center justify-between">
            <h2 class="text-2xl font-bold">Strategy Games</h2>
            <LinkButton href="/category/strategy/">
              View All
              <IconArrowRight class="inline-block rtl:-rotate-180" />
            </LinkButton>
          </div>
          <GameGrid games={strategyGames.slice(0, 6)} />
        </section>
      )
    }
  </main>
  <Footer />
</Layout>

<script>
  document.addEventListener("astro:page-load", () => {
    const indexLayout = (document.querySelector("#main-content") as HTMLElement)
      ?.dataset?.layout;
    if (indexLayout) {
      sessionStorage.setItem("backUrl", "/");
    }
  });
</script>
